<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Extractor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d9ff;
            font-size: 2.5rem;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed #00d9ff;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            background: rgba(0, 217, 255, 0.1);
            border-color: #00ff88;
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #1a1a2e;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .upload-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.4);
        }

        .upload-text {
            margin-top: 15px;
            color: #888;
        }

        .error-message {
            background: rgba(255, 71, 87, 0.2);
            border: 1px solid #ff4757;
            color: #ff4757;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .json-viewer {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 25px;
            overflow-x: auto;
        }

        .json-tree {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .tree-item {
            margin-left: 20px;
        }

        .tree-key {
            color: #00d9ff;
            font-weight: 500;
        }

        .tree-string {
            color: #00ff88;
        }

        .tree-number {
            color: #ffd93d;
        }

        .tree-boolean {
            color: #ff6b6b;
        }

        .tree-null {
            color: #888;
            font-style: italic;
        }

        .tree-toggle {
            cursor: pointer;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .tree-toggle:hover {
            background: rgba(0, 217, 255, 0.1);
            border-radius: 4px;
        }

        .toggle-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            background: rgba(0, 217, 255, 0.2);
            border-radius: 4px;
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .array-count {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #1a1a2e;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .object-count {
            background: linear-gradient(135deg, #ffd93d, #ff6b6b);
            color: #1a1a2e;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            display: none;
        }

        .bracket {
            color: #888;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(0, 217, 255, 0.1);
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        .stat-card h3 {
            color: #00d9ff;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß JSON Extractor</h1>
        
        <div class="upload-section">
            <input type="file" id="fileInput" accept=".txt,.json,.js">
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                üìÅ Dosya Se√ß
            </button>
            <p class="upload-text">JSON i√ßeren bir dosya se√ßin (.txt, .json, .js)</p>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="stats hidden" id="stats">
            <div class="stat-card">
                <h3>Toplam Karakter</h3>
                <p id="charCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Temizlenen Karakter</h3>
                <p id="cleanedCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Toplam Array</h3>
                <p id="arrayCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Toplam Obje</h3>
                <p id="objectCount">0</p>
            </div>
        </div>

        <div class="json-viewer hidden" id="jsonViewer">
            <div class="json-tree" id="jsonTree"></div>
        </div>
    </div>

    <script>
        let totalArrays = 0;
        let totalObjects = 0;

        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                processJSON(content);
            };
            reader.readAsText(file);
        }

        function cleanJSONString(str) {
            let cleaned = str;
            const originalLength = str.length;
            
            // BOM karakterini kaldƒ±r
            cleaned = cleaned.replace(/^\uFEFF/, '');
            
            // Kontrol karakterlerini kaldƒ±r (tab, newline hari√ß)
            cleaned = cleaned.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '');
            
            // String dƒ±≈üƒ±ndaki gereksiz bo≈üluklarƒ± temizle
            cleaned = cleaned.trim();
            
            // JSON ba≈ülangƒ±√ß ve biti≈ü noktalarƒ±nƒ± bul
            const jsonStart = cleaned.search(/[\[{]/);
            const jsonEndBracket = cleaned.lastIndexOf(']');
            const jsonEndBrace = cleaned.lastIndexOf('}');
            const jsonEnd = Math.max(jsonEndBracket, jsonEndBrace);
            
            if (jsonStart !== -1 && jsonEnd !== -1) {
                cleaned = cleaned.substring(jsonStart, jsonEnd + 1);
            }
            
            // Trailing comma'larƒ± d√ºzelt (JSON'da ge√ßersiz)
            cleaned = cleaned.replace(/,\s*([\]}])/g, '$1');
            
            // Tek tƒ±rnak yerine √ßift tƒ±rnak kullan
            cleaned = cleaned.replace(/'/g, '"');
            
            // Tƒ±rnaksƒ±z key'leri d√ºzelt
            cleaned = cleaned.replace(/([{,]\s*)([a-zA-Z_][a-zA-Z0-9_]*)\s*:/g, '$1"$2":');
            
            // undefined deƒüerlerini null yap
            cleaned = cleaned.replace(/:\s*undefined/g, ': null');
            
            // NaN deƒüerlerini null yap
            cleaned = cleaned.replace(/:\s*NaN/g, ': null');
            
            // Infinity deƒüerlerini null yap
            cleaned = cleaned.replace(/:\s*Infinity/g, ': null');
            cleaned = cleaned.replace(/:\s*-Infinity/g, ': null');
            
            const cleanedLength = cleaned.length;
            
            return {
                cleaned,
                originalLength,
                cleanedLength,
                removedChars: originalLength - cleanedLength
            };
        }

        // ƒ∞√ß i√ße escape edilmi≈ü string'leri recursive olarak √ß√∂z
        function decodeNestedJSON(str) {
            if (typeof str !== 'string') return str;
            
            let decoded = str;
            
            // Unicode escape'leri √ß√∂z (\u0022 -> ")
            decoded = decoded.replace(/\\u([0-9a-fA-F]{4})/g, (match, hex) => {
                return String.fromCharCode(parseInt(hex, 16));
            });
            
            // √áoklu backslash escape'leri √ß√∂z
            // \\\" -> \"  -> "
            let prevDecoded = '';
            while (prevDecoded !== decoded) {
                prevDecoded = decoded;
                decoded = decoded.replace(/\\\\"/g, '\\"');
                decoded = decoded.replace(/\\"/g, '"');
                decoded = decoded.replace(/\\\\/g, '\\');
            }
            
            return decoded;
        }

        // String deƒüerleri i√ßindeki JSON'larƒ± parse et
        function deepParseJSON(obj) {
            if (obj === null || obj === undefined) return obj;
            
            if (typeof obj === 'string') {
                // String i√ßinde JSON var mƒ± kontrol et
                const trimmed = obj.trim();
                if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || 
                    (trimmed.startsWith('[') && trimmed.endsWith(']'))) {
                    try {
                        const parsed = JSON.parse(trimmed);
                        return deepParseJSON(parsed);
                    } catch (e) {
                        // Decode edip tekrar dene
                        try {
                            const decoded = decodeNestedJSON(trimmed);
                            const parsed = JSON.parse(decoded);
                            return deepParseJSON(parsed);
                        } catch (e2) {
                            return obj;
                        }
                    }
                }
                return obj;
            }
            
            if (Array.isArray(obj)) {
                return obj.map(item => deepParseJSON(item));
            }
            
            if (typeof obj === 'object') {
                const result = {};
                for (const key in obj) {
                    result[key] = deepParseJSON(obj[key]);
                }
                return result;
            }
            
            return obj;
        }

        function processJSON(content) {
            const errorDiv = document.getElementById('errorMessage');
            const statsDiv = document.getElementById('stats');
            const viewerDiv = document.getElementById('jsonViewer');
            const treeDiv = document.getElementById('jsonTree');
            
            errorDiv.style.display = 'none';
            
            try {
                const { cleaned, originalLength, cleanedLength, removedChars } = cleanJSONString(content);
                
                let jsonData;
                try {
                    // √ñnce unicode escape'leri √ß√∂z
                    let decoded = decodeNestedJSON(cleaned);
                    jsonData = JSON.parse(decoded);
                } catch (parseError) {
                    // ƒ∞kinci deneme: daha agresif temizlik
                    try {
                        const moreClean = cleaned
                            .replace(/\\n/g, '\\\\n')
                            .replace(/\\r/g, '\\\\r')
                            .replace(/\\t/g, '\\\\t');
                        let decoded = decodeNestedJSON(moreClean);
                        jsonData = JSON.parse(decoded);
                    } catch (e2) {
                        // √ú√ß√ºnc√º deneme: ham string olarak al
                        jsonData = { rawContent: cleaned };
                    }
                }
                
                // ƒ∞√ß i√ße JSON string'leri recursive olarak parse et
                jsonData = deepParseJSON(jsonData);
                
                // ƒ∞statistikleri sƒ±fƒ±rla ve hesapla
                totalArrays = 0;
                totalObjects = 0;
                countElements(jsonData);
                
                // ƒ∞statistikleri g√∂ster
                document.getElementById('charCount').textContent = originalLength.toLocaleString();
                document.getElementById('cleanedCount').textContent = Math.abs(removedChars).toLocaleString();
                document.getElementById('arrayCount').textContent = totalArrays.toLocaleString();
                document.getElementById('objectCount').textContent = totalObjects.toLocaleString();
                
                statsDiv.classList.remove('hidden');
                viewerDiv.classList.remove('hidden');
                
                // JSON aƒüacƒ±nƒ± olu≈ütur
                treeDiv.innerHTML = renderJSON(jsonData, '');
                
            } catch (error) {
                errorDiv.textContent = `‚ùå JSON Parse Hatasƒ±: ${error.message}`;
                errorDiv.style.display = 'block';
                statsDiv.classList.add('hidden');
                viewerDiv.classList.add('hidden');
            }
        }

        function countElements(obj) {
            if (Array.isArray(obj)) {
                totalArrays++;
                obj.forEach(item => countElements(item));
            } else if (obj !== null && typeof obj === 'object') {
                totalObjects++;
                Object.values(obj).forEach(value => countElements(value));
            }
        }

        function renderJSON(data, path) {
            if (data === null) {
                return '<span class="tree-null">null</span>';
            }
            
            if (Array.isArray(data)) {
                return renderArray(data, path);
            }
            
            if (typeof data === 'object') {
                return renderObject(data, path);
            }
            
            if (typeof data === 'string') {
                const escaped = data.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<span class="tree-string">"${escaped}"</span>`;
            }
            
            if (typeof data === 'number') {
                return `<span class="tree-number">${data}</span>`;
            }
            
            if (typeof data === 'boolean') {
                return `<span class="tree-boolean">${data}</span>`;
            }
            
            return String(data);
        }

        function renderArray(arr, path) {
            const id = 'arr_' + Math.random().toString(36).substr(2, 9);
            const count = arr.length;
            
            if (count === 0) {
                return '<span class="bracket">[]</span>';
            }
            
            let html = `
                <span class="tree-toggle" onclick="toggleCollapse('${id}')">
                    <span class="toggle-icon" id="icon_${id}">‚ñº</span>
                    <span class="bracket">[</span>
                    <span class="array-count">${count} √∂ƒüe</span>
                </span>
                <div class="collapsible-content" id="${id}">
            `;
            
            arr.forEach((item, index) => {
                html += `<div class="tree-item">${renderJSON(item, path + '[' + index + ']')}${index < arr.length - 1 ? ',' : ''}</div>`;
            });
            
            html += `</div><span class="bracket">]</span>`;
            
            return html;
        }

        function renderObject(obj, path) {
            const keys = Object.keys(obj);
            const id = 'obj_' + Math.random().toString(36).substr(2, 9);
            const count = keys.length;
            
            if (count === 0) {
                return '<span class="bracket">{}</span>';
            }
            
            let html = `
                <span class="tree-toggle" onclick="toggleCollapse('${id}')">
                    <span class="toggle-icon" id="icon_${id}">‚ñº</span>
                    <span class="bracket">{</span>
                    <span class="object-count">${count} alan</span>
                </span>
                <div class="collapsible-content" id="${id}">
            `;
            
            keys.forEach((key, index) => {
                const value = obj[key];
                html += `<div class="tree-item"><span class="tree-key">"${key}"</span>: ${renderJSON(value, path + '.' + key)}${index < keys.length - 1 ? ',' : ''}</div>`;
            });
            
            html += `</div><span class="bracket">}</span>`;
            
            return html;
        }

        function toggleCollapse(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById('icon_' + id);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
                icon.textContent = '‚ñº';
            }
        }
    </script>
</body>
</html>
